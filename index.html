let meetingSession;

async function createMeeting() {
    try {
        const response = await fetch('https://your-backend-api.com/createMeeting', { method: 'POST' });
        const data = await response.json();
        
        const logger = new ChimeSDK.ConsoleLogger('ChimeMeetingLogs', ChimeSDK.LogLevel.INFO);
        const deviceController = new ChimeSDK.DefaultDeviceController(logger);
        
        const meetingResponse = data.Meeting;
        const attendeeResponse = data.Attendee;

        const configuration = new ChimeSDK.MeetingSessionConfiguration(meetingResponse, attendeeResponse);
        meetingSession = new ChimeSDK.DefaultMeetingSession(configuration, logger, deviceController);
        
        console.log("Meeting created successfully");
        await setupMeetingSession();
    } catch (error) {
        console.error("Error creating meeting:", error);
    }
}

async function setupMeetingSession() {
    try {
        if (!meetingSession || !meetingSession.audioVideo) {
            console.error("Meeting session or audioVideo is not initialized.");
            return;
        }

        const audioVideo = meetingSession.audioVideo;

        // List and select the first available audio input device
        const audioDevices = await audioVideo.listAudioInputDevices();
        if (audioDevices.length === 0) {
            console.error("No audio input devices found.");
            return;
        }
        await audioVideo.selectAudioInputDevice(audioDevices[0].deviceId);

        // List and select the first available video input device
        const videoDevices = await audioVideo.listVideoInputDevices();
        if (videoDevices.length > 0) {
            await audioVideo.startVideoInput(videoDevices[0].deviceId);
        }

        // Start the session
        audioVideo.start();
        console.log("Audio and video started successfully.");
    } catch (error) {
        console.error("Error setting up meeting session:", error);
    }
}
